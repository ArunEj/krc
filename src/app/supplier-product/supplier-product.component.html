<app-header></app-header>
<div class="container">
    <div class="row">
        <h3>Supplier Product Master</h3>
        <form [formGroup]="supplierProductForm">
            <div class="row">
                <div class="col-md-4">
                    <div class=" supplier-item">
                        <label for="branch_id" class="form-label">Branch ID<span class="txt-danger">*</span></label>
                        <input type="text" class="form-control" name="branch_id" formControlName="branch_id"
                             id="branch_id" required>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class=" supplier-item">
                        <label for="supplier_name" class="form-label">Supplier Name<span class="txt-danger">*</span></label>
                        <select class="form-control" name="supplier_name"  formControlName="supplier_name" (ngModelChange)="onChange($event)">
                            <option *ngFor="let suppData of supplierIdData" [value]="suppData.supplier_id">{{suppData.supplier_name}}</option>
    
                        </select>
                        <!-- <input type="text" class="form-control" formControlName="supplier_id" name="supplier_id" id="supplier_id"> -->
                    </div>
                </div> 
                <div class="col-md-4">
                    <div class="supplier-item">
                        <label for="supplier_id" class="form-label">Supplier ID</label>
                        <input type="text" class="form-control" formControlName="supplier_id"
                            name="supplier_id"  id="supplier_id" readonly>
                    </div>
                </div>
            </div>
            <br>
        </form>
            <table class="table table-bordered">
                <thead class="thead-dark">
                  <tr>
                    <th>Bu ID</th>
                    <th>Product Name</th>
                    <th>Product ID</th>
                    <th>Supplier Price</th>
                    <th>Effect From</th>
                    <th>Credit Days</th>
                    <th>Active</th>
                    <th>Action</th>
                  </tr> 
                </thead>
                <tbody>
                    <ng-container *ngIf="SupplierProdData && SupplierProdData.length > 0">
                        <tr *ngFor="let suppProdData of SupplierProdData">
                            <td>{{suppProdData.product_name}}</td>
    
                            <td>{{suppProdData.product_id}}</td>
                
                            <td>{{suppProdData.purchase_price}}</td>
    
                            <td>{{suppProdData.eff_from | date: 'dd-MM-yyyy'}}</td>  
                            
                            <td>{{suppProdData.credit_days}}</td>

                            <td *ngIf="suppProdData.actve_flag == 'Y'">
                                <div class="circle-green"></div>
                            </td>
                            <td *ngIf="suppProdData.actve_flag == null">
                                <div class="circle-red"></div>
                            </td>
                            
                            <td><mat-icon title="delete" class="delete-icon" aria-hidden="false" aria-label="Example home icon" disabled>delete</mat-icon> </td>
                        </tr>
                    </ng-container>
                    <tr *ngFor="let item of tableData">
                        <td>
                            <form [formGroup]="buForm">
                                <select class="form-select scrollable-menu" aria-label="Default select example" (click)="fetchProductsDynamic(item.id)" formControlName="bu_id" [(ngModel)]="item.bu_id">
                                    <option *ngFor="let bu of buList" [value]="bu.bu_id">{{bu.bu_name}}</option>                    
                                </select>
                            </form>
                        </td>
                        <td>
                            <select class="form-select scrollable-menu" aria-label="Default select example" (click)="getProductId($event)" [(ngModel)]="item.product_id">
                                <option *ngFor="let suppData of productList" [value]="suppData.product_id">{{suppData.product_name}}</option>                    
                              </select>
                        </td>

                        <td><input type="text" class="form-control no-border" [(ngModel)]="item.product_id" readonly></td>
            
                        <td><input type="text" class="form-control no-border" [(ngModel)]="item.purchase_price"></td>

                        <td><input type="text" class="form-control no-border" [(ngModel)]="item.eff_from"></td>  
                        
                        <td><input type="text" class="form-control no-border" [(ngModel)]="item.credit_days"></td>

                        <td>
                            <div class="circle-red"></div>
                        </td>
                        
                        <td><mat-icon title="delete" class="delete-icon pointer" aria-hidden="false" aria-label="Example home icon" (click)="delete_item(item)">delete</mat-icon> </td>
                    </tr>
                </tbody>
              </table>
              <br>
              <div class="row">
                <div class="col-3"></div>
                <div class="col-6">
                    <div class="row">
                        <div class="col-5">
                            <button class="btn btn-primary" (click)="addRecord()">Add Record</button>
                        </div>
                        <div class="col-5">
                            <button class="btn btn-primary" (click)="submit()">Save</button>
                        </div>
                    </div>
                </div>
                <div class="col-3"></div>
              </div>
        <!-- </form> -->
    </div>
</div>
