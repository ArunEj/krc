<app-header></app-header>
<div class="container" *ngIf="!isShowPrint">
    <div class="row" *ngIf="!patientInvoiceDetail">
        <h3>Patient Details</h3>
        <div class="patient-details">
            <label for="contact" class="form-label">Contact</label>
            <input type="text" class="form-control contact-input" required name="contact" [(ngModel)]="mobile_no"
                id="contact">
            <br>
            <button (click)="fetchUserInvoices()" [disabled]="!mobile_no" class="btn btn-primary mar20t">fetch
                Invoices</button>
        </div>
    </div>
    <div *ngIf="invoiceDetails" class="row header-border margin-20t">
        <div class="">
            <label class="mar20">Patient Id: {{patientHeader.patient_id}}</label>
            <label class="mar20">Patient Name: {{patientHeader.patient_name}}</label>
            <label class="mar20">Age: {{patientHeader.age}}</label>
            <label class="mar20">Sex: {{patientHeader.sex}}</label>
            <label class="mar20">Phone: {{patientHeader.mobile_no}}</label>
            <label class="mar20">Patient Type: {{patientHeader.patient_type}}</label>
            <!-- <label class="mar20">Last Visit: {{patientHeader?.last_visit}}</label>       -->
            <label class="mar20">Total Invoice Amount: {{patientHeader.net_inv_amount}}</label>
            <label class="mar20">Total Paid: {{patientHeader.net_inv_paid}}</label>
            <label class="mar20">Total Balance: {{patientHeader.net_inv_balance}}</label>
            <label class="mar20">Advance Amount: {{patientHeader.advance_amount_paid}}</label>
            <label class="mar20">Advance Balance: {{patientHeader.advance_amount_balance}}</label>
        </div>

    </div>
    <div *ngIf="patientInvoiceDetail && invoiceDetails?.length > 0" class="margin-20t">
        <table class="table">
            <thead>
                <tr>
                    <th scope="col">Invoice#</th>
                    <th scope="col">Net Amount</th>
                    <th scope="col">Net Paid</th>
                    <th scope="col">Net Balance</th>
                    <th scope="col">Invoice Date</th>
                   <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let item of invoiceDetails; let index">

                    <td *ngIf="!billing"><a href=""
                            [routerLink]="['/invoice', item.invoice_no, {invoice_no:item.invoice_no}]">{{item.invoice_no}}</a>
                    </td>
                    
                    <td>{{item.net_inv_amount}}</td>
                    <td>{{item.net_inv_paid}}</td>
                    <td>{{item.net_inv_balance}}</td>
                    <td>{{item.updated_date | date: 'dd/MM/yyyy'}}</td>
                   <td><mat-icon title="delete" class="cancel-icon" aria-hidden="false" aria-label="Example home icon" (click)="cancelInvoice(item)">delete</mat-icon>
                    <mat-icon class="print-icon" (click)="print(item)">print</mat-icon>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<ng-container *ngIf="isShowPrint">
    <div id="print-section">
        <div class="invoice-container-txt" *ngIf="invoiceData">
            <div class="d-flex">
                <div class="invoice-address">
                  <div>{{invoiceData.branch_name}}</div>
                  <div>{{invoiceData.branch_address}}</div>
                  <div class="row">
                    <div class="col-6">{{invoiceData.branch_contact_num}}</div>
                    <div class="col-6">{{invoiceData.branch_cont_pers_phone}}</div>
                  </div>
                </div>
            </div>
            <h6 class="b-1 d-flex">INVOICE CUM RECEIPT</h6>
            <div class="row">
                <div class="col-4">Id : {{invoiceData.patient_id}}</div>
                <div class="col-4">Name : {{invoiceData.patient_name}}</div>
                <div class="col-2">Sex : {{invoiceData.sex}}</div>
                <div class="col-2">Age : {{invoiceData.age}}</div>
            </div>
            <div class="col-md-12">Ref : Dr.R.Vijayakumar/ Dr.V.Abhinesh</div>
            <div class="d-flex b-1">Inv No : 123456 123456     Inv Dt : 01-Jun-2022									
            </div>
            <table>
                <tr>
                  <th>Sl No</th>
                  <th>Description</th>
                  <th>Rate</th>
                  <th>Qty</th>
                  <th>Amount</th>
                  <th>Discount</th>
                  <th>Net amount</th>
                  <th>Received</th>
                  <th>mode</th>
                  <th>Balance</th>
                </tr>
                <tr *ngFor="let data of invoiceData.invoice_lists">
                  <td>{{data.inv_srl_no}}</td>
                  <td> {{data.product_name}}</td>
                  <td>{{data.product_value}}</td>
                  <td>{{data.product_qty}}</td>
                  <td>{{data.net_amount}}</td>
                  <td>{{data.gross_discount}}</td>
                  <td>{{data.net_amount}}</td>
                  <td> {{data.received}}</td>
                  <td>{{data.mode || 'c'}}</td>
                  <td>{{data.net_balance}}</td>
                </tr>
              </table>
        </div>
    </div>
    <div class="d-flex">
        <button type="button" class="btn btn-primary mar20t" [useExistingCss]="true" id="print-to-pdf" printSectionId="print-section"  ngxPrint >Print to Pdf</button>
    </div>
</ng-container>

